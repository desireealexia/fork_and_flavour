{% extends 'base.html' %}

{% load static %}

{% block title %}Create Recipe - Fork & Flavour{% endblock %}

{% block content %}
<div class="container">
    <h1 class="text-center mb-4">Create a New Recipe</h1>
    
    <form method="POST" enctype="multipart/form-data" class="recipe-form">
        {% csrf_token %}
    
        <div class="mb-3">
            <label for="title" class="form-label">Recipe Title</label>
            {{ form.title }}
        </div>
    
        <div class="mb-3">
            <label for="description" class="form-label">Description</label>
            {{ form.description }}
        </div>
    
        <div class="mb-3">
            <label for="category" class="form-label">Category</label>
            {{ form.category }}
        </div>
    
        <div class="mb-3">
            <label for="status" class="form-label">Recipe Status</label>
            {{ form.status }}
        </div>
    
        <div class="mb-3" id="ingredients-forms">
            <label for="ingredients" class="form-label">Ingredients (One per line)</label>
            <table id="ingredients-table">
                <thead>
                    <tr>
                        <th>Ingredient</th>
                        <th>Quantity</th>
                        <th>Unit</th>
                        <th>Optional</th>
                        <th>Remove</th>
                    </tr>
                </thead>
                <tbody>
                    {% for form in ingredient_formset %}
                        <tr class="ingredient-row">
                            <td>{{ form.ingredient }}</td>
                            <td>{{ form.quantity }}</td>
                            <td>{{ form.unit }}</td>
                            <td>{{ form.is_optional }}</td>
                            <td>
                                <button type="button" class="remove-ingredient-btn">Remove</button>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <button type="button" id="add-ingredient">Add Another Ingredient</button>
    
        <div class="mb-3">
            <label for="instructions" class="form-label">Preparation Steps</label>
            {{ form.instructions }}
        </div>
    
        <div class="mb-3">
            <label for="image" class="form-label">Upload Image</label>
            {{ form.image }}
        </div>
        <button type="submit" class="btn btn-primary w-100">Submit Recipe</button>
    </form>
</div>
<script>
     // Add a new ingredient row dynamically when "Add Another Ingredient" button is clicked
     document.getElementById('add-ingredient').addEventListener('click', function() {
        const ingredientsTable = document.getElementById('ingredients-table').getElementsByTagName('tbody')[0];
        const firstRow = ingredientsTable.querySelector('.ingredient-row');
        const newRow = firstRow.cloneNode(true);
        ingredientsTable.appendChild(newRow);
    });

    // Remove ingredient row
    document.getElementById('ingredients-table').addEventListener('click', function(event) {
        if (event.target.classList.contains('remove-ingredient-btn')) {
            // Find the closest row to the clicked button and remove it
            event.target.closest('tr').remove();
        }
    });
</script>
{% endblock %}
